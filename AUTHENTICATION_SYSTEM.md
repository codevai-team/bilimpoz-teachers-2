# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Bilimpoz Admin, –≤–∫–ª—é—á–∞—è:
- –ü—Ä–æ—Ü–µ—Å—Å –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É
- –†–∞–±–æ—Ç—É —Å –ø–∞—Ä–æ–ª—è–º–∏ –∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—é –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é JWT —Ç–æ–∫–µ–Ω–æ–≤
- –†–∞–±–æ—Ç—É —Å cookies
- –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ Telegram
- –•—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–¥–æ–≤ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∑–∞—â–∏—Ç—É –¥–∞–Ω–Ω—ã—Ö

---

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 1.1 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ö–ª–∏–µ–Ω—Ç (UI)   ‚îÇ
‚îÇ  LoginForm.tsx  ‚îÇ
‚îÇ TelegramForm.tsx‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  API Routes     ‚îÇ
‚îÇ  /api/auth/*    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Core Libraries ‚îÇ
‚îÇ  auth.ts        ‚îÇ
‚îÇ  verification.ts‚îÇ
‚îÇ  telegram.ts    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Database      ‚îÇ
‚îÇ   PostgreSQL    ‚îÇ
‚îÇ   (Prisma ORM)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 1.2 –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `src/lib/auth.ts` | –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, JWT) |
| `src/lib/verification.ts` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–æ–≤ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è |
| `src/lib/telegram.ts` | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram API |
| `src/lib/client-auth.ts` | –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–∫–µ–Ω–∞–º–∏ |
| `src/app/api/auth/login/route.ts` | API —Ä–æ—É—Ç –¥–ª—è –≤—Ö–æ–¥–∞ |
| `src/app/api/auth/verify-code/route.ts` | API —Ä–æ—É—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞ |
| `src/app/api/auth/resend-code/route.ts` | API —Ä–æ—É—Ç –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞ |
| `src/app/api/auth/logout/route.ts` | API —Ä–æ—É—Ç –¥–ª—è –≤—ã—Ö–æ–¥–∞ |
| `src/contexts/AuthContext.tsx` | React –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |

---

## 2. –ü—Ä–æ—Ü–µ—Å—Å –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É

### 2.1 API Endpoint: `/api/auth/login`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/app/api/auth/login/route.ts`

**–ú–µ—Ç–æ–¥:** `POST`

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "login": "string",
  "password": "string"
}
```

**–ü—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

#### –®–∞–≥ 1: –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```typescript
if (!login || !password) {
  return NextResponse.json(
    { error: '–õ–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' },
    { status: 400 }
  )
}
```

#### –®–∞–≥ 2: –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
```typescript
const user = await prisma.users.findUnique({
  where: { login: login },
  select: {
    id: true,
    name: true,
    login: true,
    hash_password: true,
    role: true,
    status: true,
    telegram_id: true
  }
})
```

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:**
- **–¢–∞–±–ª–∏—Ü–∞:** `users` (PostgreSQL)
- **–ü–æ–ª–µ –¥–ª—è –ø–æ–∏—Å–∫–∞:** `login` (—É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ)
- **–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –ø–æ–ª—è:** –ò—Å–∫–ª—é—á–∞–µ—Ç—Å—è `hash_password` –∏–∑ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

#### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```typescript
if (!user) {
  return NextResponse.json(
    { error: '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å' },
    { status: 401 }
  )
}
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–±–æ—Ä–∞).

#### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```typescript
if (user.status === 'banned' || user.status === 'deleted') {
  return NextResponse.json(
    { error: '–ê–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ —É–¥–∞–ª–µ–Ω' },
    { status: 403 }
  )
}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã:**
- `registered` - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
- `verified` - –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
- `banned` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
- `deleted` - —É–¥–∞–ª–µ–Ω

#### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
```typescript
const isPasswordValid = await verifyPassword(password, user.hash_password)

if (!isPasswordValid) {
  return NextResponse.json(
    { error: '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å' },
    { status: 401 }
  )
}
```

**–§—É–Ω–∫—Ü–∏—è `verifyPassword`:**
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/lib/auth.ts`
- **–ê–ª–≥–æ—Ä–∏—Ç–º:** `bcrypt.compare()`
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–µ –≤—Ä–µ–º—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–∑–∞—â–∏—Ç–∞ –æ—Ç timing attacks)

#### –®–∞–≥ 6: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞
```typescript
const token = generateToken({
  userId: user.id,
  login: user.login,
  role: user.role
})
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–æ–∫–µ–Ω–∞:**
- `userId` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `login` - –ª–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `role` - —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`admin`, `teacher`, `student`)
- `exp` - —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (7 –¥–Ω–µ–π)
- `iat` - –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è

#### –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Telegram ID

**–í–∞—Ä–∏–∞–Ω—Ç A: –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç Telegram ID**
```typescript
if (!user.telegram_id) {
  const response = NextResponse.json({
    success: true,
    user: userWithoutPassword,
    token: token,
    message: '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞',
    requiresTelegramVerification: true
  })
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ–∫–µ–Ω –≤ cookies
  response.cookies.set('auth-token', token, {
    httpOnly: false,
    secure: process.env.NODE_ENV === 'production',
    sameSite: 'lax',
    maxAge: 7 * 24 * 60 * 60, // 7 –¥–Ω–µ–π
    path: '/'
  })
  
  return response
}
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å Telegram ID (–¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)**

```typescript
// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
const verificationCode = generateVerificationCode()
await storeVerificationCode(user.id, verificationCode)

// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–¥ –≤ Telegram
const messageSent = await telegramService.sendVerificationCode(
  user.telegram_id, 
  verificationCode
)

if (!messageSent) {
  return NextResponse.json({
    error: '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞ –≤ Telegram'
  }, { status: 500 })
}

const response = NextResponse.json({
  success: true,
  user: userWithoutPassword,
  token: token,
  message: '–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram',
  requiresVerification: true
})

// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ–∫–µ–Ω –≤ cookies
response.cookies.set('auth-token', token, {
  httpOnly: false,
  secure: process.env.NODE_ENV === 'production',
  sameSite: 'lax',
  maxAge: 7 * 24 * 60 * 60,
  path: '/'
})

return response
```

**–û—Ç–≤–µ—Ç API:**
```json
{
  "success": true,
  "user": {
    "id": "uuid",
    "name": "string",
    "login": "string",
    "role": "admin|teacher|student",
    "status": "registered|verified|banned|deleted",
    "telegram_id": "string|null"
  },
  "token": "jwt_token_string",
  "message": "–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram",
  "requiresVerification": true
}
```

---

## 3. –†–∞–±–æ—Ç–∞ —Å –ø–∞—Ä–æ–ª—è–º–∏

### 3.1 –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

**–§—É–Ω–∫—Ü–∏—è:** `hashPassword(password: string): Promise<string>`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/lib/auth.ts`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
import bcrypt from 'bcryptjs'

export async function hashPassword(password: string): Promise<string> {
  const saltRounds = 12
  return await bcrypt.hash(password, saltRounds)
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- **–ê–ª–≥–æ—Ä–∏—Ç–º:** bcrypt
- **Salt rounds:** 12 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
- **–í—Ä–µ–º—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:** ~300-500ms (–∑–∞—â–∏—Ç–∞ –æ—Ç brute-force)

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è

### 3.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª–µ–π

**–§—É–Ω–∫—Ü–∏—è:** `verifyPassword(password: string, hashedPassword: string): Promise<boolean>`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/lib/auth.ts`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
export async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {
  return await bcrypt.compare(password, hashedPassword)
}
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–µ –≤—Ä–µ–º—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- –ó–∞—â–∏—Ç–∞ –æ—Ç timing attacks
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ salt –∏–∑ —Ö–µ—à–∞

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Å–∏—Å—Ç–µ–º—É (`/api/auth/login`)
- –ü—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –ø–∞—Ä–æ–ª—è)

---

## 4. JWT —Ç–æ–∫–µ–Ω—ã

### 4.1 –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤

**–§—É–Ω–∫—Ü–∏—è:** `generateToken(payload: JWTPayload): string`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/lib/auth.ts`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
import jwt from 'jsonwebtoken'

const JWT_SECRET = process.env.JWT_SECRET || 'your-super-secret-jwt-key-change-in-production'
const JWT_EXPIRES_IN = '7d'

export interface JWTPayload {
  userId: string
  login: string
  role: string
  iat?: number
  exp?: number
}

export function generateToken(payload: Omit<JWTPayload, 'iat' | 'exp'>): string {
  return jwt.sign(payload, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN })
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- **–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á:** `JWT_SECRET` –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:** 7 –¥–Ω–µ–π (`7d`)
- **–ê–ª–≥–æ—Ä–∏—Ç–º:** HS256 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è `jwt.sign`)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–æ–∫–µ–Ω–∞:**
```
header.payload.signature
```

**Payload —Å–æ–¥–µ—Ä–∂–∏—Ç:**
```json
{
  "userId": "uuid",
  "login": "string",
  "role": "admin|teacher|student",
  "iat": 1234567890,
  "exp": 1235173890
}
```

### 4.2 –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤

**–§—É–Ω–∫—Ü–∏—è:** `verifyToken(token: string): JWTPayload | null`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/lib/auth.ts`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
export function verifyToken(token: string): JWTPayload | null {
  try {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–æ–∫–µ–Ω–∞
    if (!token || typeof token !== 'string' || token.trim() === '') {
      return null
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã JWT (–¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 2 —Ç–æ—á–∫–∏)
    const parts = token.split('.')
    if (parts.length !== 3) {
      return null
    }

    // –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
    const payload = jwt.verify(token, JWT_SECRET) as JWTPayload
    
    return payload
  } catch (error) {
    if (error instanceof jwt.TokenExpiredError) {
      console.error('[verifyToken] ‚úó Token EXPIRED')
    } else if (error instanceof jwt.JsonWebTokenError) {
      console.error('[verifyToken] ‚úó Invalid token')
    }
    return null
  }
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
1. –§–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞ (–Ω–µ –ø—É—Å—Ç–æ–π, —Å—Ç—Ä–æ–∫–∞)
2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JWT (3 —á–∞—Å—Ç–∏, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ —Ç–æ—á–∫–∞–º–∏)
3. –ü–æ–¥–ø–∏—Å—å —Ç–æ–∫–µ–Ω–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞)
4. –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (exp)
5. –§–æ—Ä–º–∞—Ç payload

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:**
- `JWTPayload` - –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω
- `null` - –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω –∏–ª–∏ –∏—Å—Ç–µ–∫

### 4.3 –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

**–§—É–Ω–∫—Ü–∏—è:** `auth(request: NextRequest)`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/lib/auth.ts`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
export async function auth(request: NextRequest) {
  // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization
  const authHeader = request.headers.get('authorization')
  
  if (!authHeader || !authHeader.startsWith('Bearer ')) {
    return null
  }

  const token = authHeader.substring(7) // –£–±–∏—Ä–∞–µ–º "Bearer "
  const payload = verifyToken(token)
  
  if (!payload) {
    return null
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
  try {
    const user = await prisma.users.findUnique({
      where: { id: payload.userId },
      select: {
        id: true,
        name: true,
        login: true,
        profile_photo_url: true,
        role: true,
        status: true,
        telegram_id: true
      }
    })
    
    if (!user) {
      return null
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (user.status === 'banned' || user.status === 'deleted') {
      return null
    }
    
    return user
  } catch (error) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
    if (error instanceof PrismaClientInitializationError || 
        (error instanceof Prisma.PrismaClientKnownRequestError && error.code === 'P1001')) {
      throw new Error('DATABASE_CONNECTION_ERROR')
    }
    throw error
  }
}
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `Authorization: Bearer <token>`
2. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ `verifyToken()`
3. –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. –í–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ `null`

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ `DATABASE_CONNECTION_ERROR`
- –î—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –¥–∞–ª—å—à–µ

### 4.4 –•–µ–ª–ø–µ—Ä –¥–ª—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —Ä–æ—É—Ç–æ–≤

**–§—É–Ω–∫—Ü–∏—è:** `authenticatedHandler(request, handler)`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/lib/auth.ts`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
export async function authenticatedHandler(
  request: NextRequest,
  handler: (user: Awaited<ReturnType<typeof auth>>) => Promise<NextResponse>
): Promise<NextResponse> {
  try {
    const user = await auth(request)
    
    if (!user) {
      return NextResponse.json(
        { error: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' },
        { status: 401 }
      )
    }

    return await handler(user)
  } catch (error) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
    if (error instanceof Error && error.message === 'DATABASE_CONNECTION_ERROR') {
      return NextResponse.json(
        { 
          error: '–ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...',
          code: 'DATABASE_CONNECTION_ERROR'
        },
        { status: 503 }
      )
    }
    
    return NextResponse.json(
      { error: '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' },
      { status: 500 }
    )
  }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
export async function GET(request: NextRequest) {
  return authenticatedHandler(request, async (user) => {
    // user –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–µ null
    return NextResponse.json(user)
  })
}
```

---

## 5. –†–∞–±–æ—Ç–∞ —Å Cookies

### 5.1 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤ Cookies (—Å–µ—Ä–≤–µ—Ä)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** API —Ä–æ—É—Ç—ã (`/api/auth/login`, `/api/auth/verify-code`)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
response.cookies.set('auth-token', token, {
  httpOnly: false, // –ù—É–∂–Ω–æ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ JavaScript
  secure: process.env.NODE_ENV === 'production', // HTTPS —Ç–æ–ª—å–∫–æ –≤ production
  sameSite: 'lax', // –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF
  maxAge: 7 * 24 * 60 * 60, // 7 –¥–Ω–µ–π (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
  path: '/' // –î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤—Å–µ—Ö –ø—É—Ç–µ–π
})
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- **httpOnly:** `false` - –ø–æ–∑–≤–æ–ª—è–µ—Ç JavaScript —á–∏—Ç–∞—Ç—å cookie (–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
- **secure:** `true` –≤ production - –ø–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–ª—å–∫–æ –ø–æ HTTPS
- **sameSite:** `lax` - –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF, –Ω–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—ã –ø–æ —Å—Å—ã–ª–∫–∞–º
- **maxAge:** `604800` —Å–µ–∫—É–Ω–¥ (7 –¥–Ω–µ–π)
- **path:** `/` - –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤—Å–µ—Ö –ø—É—Ç–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –í production –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTPS (`secure: true`)
- `sameSite: 'lax'` –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç CSRF –∞—Ç–∞–∫
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω 7 –¥–Ω—è–º–∏

### 5.2 –ß—Ç–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ Cookies (–∫–ª–∏–µ–Ω—Ç)

**–§—É–Ω–∫—Ü–∏—è:** `getAuthToken(): string | null`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/lib/client-auth.ts`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
export function getAuthToken(): string | null {
  if (typeof window === 'undefined') return null
  
  // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω —Ç–æ–ª—å–∫–æ –∏–∑ cookies (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã)
  const cookies = document.cookie.split(';')
  const authCookie = cookies.find(cookie => cookie.trim().startsWith('auth-token='))
  
  if (authCookie) {
    const token = authCookie.split('=')[1]
    return token
  }
  
  return null
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (`typeof window !== 'undefined'`)
- –ü–∞—Ä—Å–∏—Ç `document.cookie` –≤—Ä—É—á–Ω—É—é
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `null` –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω

### 5.3 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤ Cookies (–∫–ª–∏–µ–Ω—Ç)

**–§—É–Ω–∫—Ü–∏—è:** `setAuthToken(token: string): void`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/lib/client-auth.ts`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
export function setAuthToken(token: string): void {
  if (typeof window === 'undefined') return
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º cookie —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å —Å–µ—Ä–≤–µ—Ä–æ–º)
  const isSecure = window.location.protocol === 'https:'
  const maxAge = 7 * 24 * 60 * 60 // 7 –¥–Ω–µ–π
  
  const cookieString = `auth-token=${token}; path=/; max-age=${maxAge}; ${isSecure ? 'secure;' : ''} samesite=lax`
  document.cookie = cookieString
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (`https:` ‚Üí `secure`)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å —Å–µ—Ä–≤–µ—Ä–æ–º
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `max-age` –∏ `samesite`

### 5.4 –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ Cookies

**–§—É–Ω–∫—Ü–∏—è:** `removeAuthToken(): void`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/lib/client-auth.ts`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
export function removeAuthToken(): void {
  if (typeof window === 'undefined') return
  
  // –£–¥–∞–ª—è–µ–º cookie –∏ –∫—ç—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  document.cookie = 'auth-token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT'
  localStorage.removeItem('user')
}
```

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –£–¥–∞–ª—è–µ—Ç cookie (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–∞—Ç—É –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤ –ø—Ä–æ—à–ª–æ–µ)
2. –£–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ `localStorage`

### 5.5 –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤

**–§—É–Ω–∫—Ü–∏—è:** `getAuthHeaders(): HeadersInit`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/lib/client-auth.ts`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
export function getAuthHeaders(): HeadersInit {
  const token = getAuthToken()
  
  if (!token) {
    return {
      'Content-Type': 'application/json',
    }
  }
  
  return {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json',
  }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
const response = await fetch('/api/user/me', {
  headers: getAuthHeaders()
})
```

---

## 6. –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–æ–¥–∞ (Telegram 2FA)

### 6.1 –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

**–§—É–Ω–∫—Ü–∏—è:** `generateVerificationCode(): string`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/lib/verification.ts`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
export function generateVerificationCode(): string {
  const code = Math.floor(100000 + Math.random() * 900000).toString()
  console.log('Generated verification code:', code)
  return code
}
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- **–î–ª–∏–Ω–∞:** 6 —Ü–∏—Ñ—Ä
- **–î–∏–∞–ø–∞–∑–æ–Ω:** 100000 - 999999
- **–§–æ—Ä–º–∞—Ç:** –°—Ç—Ä–æ–∫–∞ –∏–∑ 6 —Ü–∏—Ñ—Ä
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `Math.random()` (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö –∫–æ–¥–æ–≤)

**–ü—Ä–∏–º–µ—Ä:** `"123456"`, `"789012"`

### 6.2 –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

**–§—É–Ω–∫—Ü–∏—è:** `storeVerificationCode(userId: string, code: string): Promise<void>`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/lib/verification.ts`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ –ø–∞–º—è—Ç–∏ (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏)
const verificationCodes = new Map<string, { code: string; expiresAt: Date; userId: string; createdAt: Date }>()
const verificationCodesBackup = new Map<string, { code: string; expiresAt: Date; userId: string; createdAt: Date }>()

export async function storeVerificationCode(userId: string, code: string): Promise<void> {
  const expiresAt = new Date(Date.now() + 5 * 60 * 1000) // 5 –º–∏–Ω—É—Ç
  const createdAt = new Date()
  const codeData = { code, expiresAt, userId, createdAt }
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
  verificationCodes.set(userId, codeData)
  verificationCodesBackup.set(userId, { ...codeData })
  
  // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
  try {
    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–æ–¥—ã –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await prisma.settings.deleteMany({
      where: {
        key: {
          startsWith: `verification_code_${userId}_`
        }
      }
    })
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–π –∫–æ–¥ —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π –∏—Å—Ç–µ—á–µ–Ω–∏—è
    const settingKey = `verification_code_${userId}_${Date.now()}`
    const settingValue = JSON.stringify({
      code,
      expiresAt: expiresAt.toISOString(),
      createdAt: createdAt.toISOString()
    })
    
    await prisma.settings.create({
      data: {
        key: settingKey,
        value: settingValue
      }
    })
  } catch (dbError) {
    console.error('Failed to save verification code to database:', dbError)
    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É —Å –ø–∞–º—è—Ç—å—é –¥–∞–∂–µ –µ—Å–ª–∏ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
  }
  
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –∫–æ–¥–æ–≤
  setTimeout(() => {
    verificationCodes.delete(userId)
    verificationCodesBackup.delete(userId)
  }, 5 * 60 * 1000)
}
```

**–•—Ä–∞–Ω–µ–Ω–∏–µ:**
1. **–í –ø–∞–º—è—Ç–∏ (–æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ):** `Map<userId, codeData>`
2. **–í –ø–∞–º—è—Ç–∏ (—Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è):** `Map<userId, codeData>` (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)
3. **–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:** –¢–∞–±–ª–∏—Ü–∞ `settings` —Å –∫–ª—é—á–æ–º `verification_code_{userId}_{timestamp}`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
```typescript
{
  code: string,           // 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
  expiresAt: Date,        // –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è (5 –º–∏–Ω—É—Ç)
  userId: string,         // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  createdAt: Date         // –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
}
```

**–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:** 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫—É–Ω–¥)

**–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:**
- –ö–æ–¥—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–∞–º—è—Ç—å—é

### 6.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

**–§—É–Ω–∫—Ü–∏—è:** `verifyCode(userId: string, inputCode: string): Promise<boolean>`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/lib/verification.ts`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
export async function verifyCode(userId: string, inputCode: string): Promise<boolean> {
  // 1. –ü–æ–∏—Å–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
  let stored = verificationCodes.get(userId)
  
  // 2. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
  if (!stored) {
    stored = verificationCodesBackup.get(userId)
    if (stored) {
      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤ –æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
      verificationCodes.set(userId, stored)
    }
  }
  
  // 3. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –ø–∞–º—è—Ç–∏, –ø—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
  if (!stored) {
    const dbCodes = await prisma.settings.findMany({
      where: {
        key: { startsWith: `verification_code_${userId}_` }
      },
      orderBy: { created_at: 'desc' },
      take: 1
    })
    
    if (dbCodes.length > 0) {
      const dbCode = dbCodes[0]
      const codeData = JSON.parse(dbCode.value)
      const expiresAt = new Date(codeData.expiresAt)
      
      if (expiresAt > new Date()) {
        stored = {
          code: codeData.code,
          expiresAt: expiresAt,
          userId: userId,
          createdAt: new Date(codeData.createdAt)
        }
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤ –ø–∞–º—è—Ç—å
        verificationCodes.set(userId, stored)
        verificationCodesBackup.set(userId, { ...stored })
      } else {
        // –£–¥–∞–ª—è–µ–º –∏—Å—Ç–µ–∫—à–∏–π –∫–æ–¥ –∏–∑ –ë–î
        await prisma.settings.delete({ where: { id: dbCode.id } })
      }
    }
  }
  
  // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
  if (!stored) {
    return false
  }
  
  // 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
  if (new Date() > stored.expiresAt) {
    // –£–¥–∞–ª—è–µ–º –∏—Å—Ç–µ–∫—à–∏–π –∫–æ–¥
    verificationCodes.delete(userId)
    verificationCodesBackup.delete(userId)
    await prisma.settings.deleteMany({
      where: { key: { startsWith: `verification_code_${userId}_` } }
    })
    return false
  }
  
  // 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–æ–¥–∞
  if (stored.code !== inputCode) {
    return false
  }
  
  // 7. –ö–æ–¥ –≤–µ—Ä–Ω—ã–π, —É–¥–∞–ª—è–µ–º –µ–≥–æ –∏–∑ –≤—Å–µ—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â
  verificationCodes.delete(userId)
  verificationCodesBackup.delete(userId)
  await prisma.settings.deleteMany({
    where: { key: { startsWith: `verification_code_${userId}_` } }
  })
  
  return true
}
```

**–ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–≤–µ—Ä–∫–∏:**
1. –ü–æ–∏—Å–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–∞–º—è—Ç–∏
2. –ü–æ–∏—Å–∫ –≤ —Ä–µ–∑–µ—Ä–≤–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–∞–º—è—Ç–∏
3. –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –ø–∞–º—è—Ç–∏)
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
5. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–¥–æ–≤
6. –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –ö–æ–¥ —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 6.4 API Endpoint: `/api/auth/verify-code`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/app/api/auth/verify-code/route.ts`

**–ú–µ—Ç–æ–¥:** `POST`

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "userId": "uuid",
  "code": "123456"
}
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
```typescript
export async function POST(request: NextRequest) {
  const { userId, code } = await request.json()

  // –í–∞–ª–∏–¥–∞—Ü–∏—è
  if (!userId || !code) {
    return NextResponse.json(
      { error: 'ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∫–æ–¥ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã' },
      { status: 400 }
    )
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
  const isValid = await verifyCode(userId, code)
  
  if (!isValid) {
    return NextResponse.json(
      { error: '–ù–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –∏—Å—Ç–µ–∫—à–∏–π –∫–æ–¥' },
      { status: 401 }
    )
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const user = await prisma.users.findUnique({
    where: { id: userId },
    select: {
      id: true,
      name: true,
      login: true,
      role: true,
      status: true
    }
  })

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
  if (user.status === 'banned' || user.status === 'deleted') {
    return NextResponse.json(
      { error: '–ê–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ —É–¥–∞–ª–µ–Ω' },
      { status: 403 }
    )
  }

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ JWT —Ç–æ–∫–µ–Ω–∞
  const token = generateToken({
    userId: user.id,
    login: user.login,
    role: user.role
  })

  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤ cookies
  const response = NextResponse.json({
    success: true,
    message: '–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ',
    token,
    user: {
      id: user.id,
      name: user.name,
      login: user.login,
      role: user.role
    }
  })
  
  response.cookies.set('auth-token', token, {
    httpOnly: false,
    secure: process.env.NODE_ENV === 'production',
    sameSite: 'lax',
    maxAge: 7 * 24 * 60 * 60,
    path: '/'
  })
  
  return response
}
```

**–û—Ç–≤–µ—Ç –ø—Ä–∏ —É—Å–ø–µ—Ö–µ:**
```json
{
  "success": true,
  "message": "–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ",
  "token": "jwt_token_string",
  "user": {
    "id": "uuid",
    "name": "string",
    "login": "string",
    "role": "admin|teacher|student"
  }
}
```

### 6.5 API Endpoint: `/api/auth/resend-code`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/app/api/auth/resend-code/route.ts`

**–ú–µ—Ç–æ–¥:** `POST`

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "userId": "uuid"
}
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
```typescript
export async function POST(request: NextRequest) {
  const { userId } = await request.json()

  // –í–∞–ª–∏–¥–∞—Ü–∏—è
  if (!userId) {
    return NextResponse.json(
      { error: 'ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω' },
      { status: 400 }
    )
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const user = await prisma.users.findUnique({
    where: { id: userId },
    select: {
      id: true,
      name: true,
      telegram_id: true,
      status: true
    }
  })

  // –ü—Ä–æ–≤–µ—Ä–∫–∏
  if (!user) {
    return NextResponse.json(
      { error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' },
      { status: 404 }
    )
  }

  if (!user.telegram_id) {
    return NextResponse.json(
      { error: '–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω Telegram' },
      { status: 400 }
    )
  }

  if (user.status === 'banned' || user.status === 'deleted') {
    return NextResponse.json(
      { error: '–ê–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ —É–¥–∞–ª–µ–Ω' },
      { status: 403 }
    )
  }

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞
  const verificationCode = generateVerificationCode()
  await storeVerificationCode(user.id, verificationCode)

  // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
  const messageSent = await telegramService.sendVerificationCode(
    user.telegram_id, 
    verificationCode
  )
  
  if (!messageSent) {
    return NextResponse.json({
      error: '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞ –≤ Telegram'
    }, { status: 500 })
  }

  return NextResponse.json({
    success: true,
    message: '–ù–æ–≤—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram'
  })
}
```

**–û—Ç–≤–µ—Ç –ø—Ä–∏ —É—Å–ø–µ—Ö–µ:**
```json
{
  "success": true,
  "message": "–ù–æ–≤—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram"
}
```

---

## 7. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram

### 7.1 Telegram Service

**–ö–ª–∞—Å—Å:** `TelegramService`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/lib/telegram.ts`

**–≠–∫—Å–ø–æ—Ä—Ç:** `telegramService` (singleton)

### 7.2 –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞

**–ú–µ—Ç–æ–¥:** `getBotToken(tokenType: 'ADMIN_BOT_TOKEN' | 'STUDENT_BOT_TOKEN'): Promise<string>`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
async getBotToken(tokenType: 'ADMIN_BOT_TOKEN' | 'STUDENT_BOT_TOKEN' = 'ADMIN_BOT_TOKEN'): Promise<string> {
  // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è ADMIN_BOT_TOKEN
  if (tokenType === 'ADMIN_BOT_TOKEN' && this.botToken) {
    return this.botToken
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  const setting = await prisma.settings.findUnique({
    where: { key: tokenType }
  })

  if (!setting?.value) {
    throw new Error(`Telegram bot token not found in settings for ${tokenType}`)
  }

  // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
  if (tokenType === 'ADMIN_BOT_TOKEN') {
    this.botToken = setting.value
  }
  
  return setting.value
}
```

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:**
- **–¢–∞–±–ª–∏—Ü–∞:** `settings`
- **–ö–ª—é—á:** `ADMIN_BOT_TOKEN` –∏–ª–∏ `STUDENT_BOT_TOKEN`
- **–ó–Ω–∞—á–µ–Ω–∏–µ:** –¢–æ–∫–µ–Ω –±–æ—Ç–∞ Telegram (—Ñ–æ—Ä–º–∞—Ç: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –¢–æ–∫–µ–Ω –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –±–æ—Ç–∞ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
- –¢–æ–∫–µ–Ω —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–æ–≥–æ –±–æ—Ç–∞ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∏–∑ –ë–î

### 7.3 –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

**–ú–µ—Ç–æ–¥:** `sendMessage(chatId: string, message: string): Promise<boolean>`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
async sendMessage(chatId: string, message: string): Promise<boolean> {
  try {
    const botToken = await this.getBotToken('ADMIN_BOT_TOKEN')
    
    const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        chat_id: chatId,
        text: message,
        parse_mode: 'Markdown'
      }),
    })

    const result = await response.json()
    
    if (!response.ok) {
      console.error('Telegram API error:', result)
      return false
    }

    return result.ok
  } catch (error) {
    console.error('Error sending Telegram message:', error)
    return false
  }
}
```

**API Endpoint:** `https://api.telegram.org/bot{token}/sendMessage`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `chat_id` - Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—Ç—Ä–æ–∫–∞)
- `text` - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- `parse_mode` - `Markdown` (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:**
- `true` - —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
- `false` - –æ—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

### 7.4 –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

**–ú–µ—Ç–æ–¥:** `sendVerificationCode(telegramId: string, code: string): Promise<boolean>`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
async sendVerificationCode(telegramId: string, code: string): Promise<boolean> {
  const message = `üîê *–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—Ö–æ–¥–∞*

–í–∞—à –∫–æ–¥: \`${code}\`

–í–≤–µ–¥–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É.

‚è∞ –ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç.`

  return await this.sendMessage(telegramId, message)
}
```

**–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö–æ–¥ –≤—ã–¥–µ–ª–µ–Ω –≤ –º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (`` `code` ``)
- –°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ä–æ–∫–µ –¥–µ–π—Å—Ç–≤–∏—è

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:**
- `telegramId` - –±–µ—Ä–µ—Ç—Å—è –∏–∑ –ø–æ–ª—è `telegram_id` —Ç–∞–±–ª–∏—Ü—ã `users`
- `code` - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π `generateVerificationCode()`

### 7.5 –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞—Å—Å—ã–ª–∫–∏

**–ú–µ—Ç–æ–¥:** `sendBroadcast(telegramIds: string[], message: string, options?): Promise<{success, failed, errors}>`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
async sendBroadcast(
  telegramIds: string[], 
  message: string, 
  options?: {
    ctaText?: string;
    ctaLink?: string;
    parseMode?: 'Markdown' | 'HTML';
  }
): Promise<{
  success: number;
  failed: number;
  errors: Array<{ telegramId: string; error: string }>;
}> {
  const botToken = await this.getBotToken('STUDENT_BOT_TOKEN')
  
  let success = 0
  let failed = 0
  const errors: Array<{ telegramId: string; error: string }> = []

  // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–Ω–æ–ø–∫–æ–π (–µ—Å–ª–∏ –µ—Å—Ç—å CTA)
  let messageText = message
  if (options?.ctaText && options?.ctaLink) {
    messageText += `\n\n[${options.ctaText}](${options.ctaLink})`
  }

  // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∞–∫–µ—Ç–∞–º–∏ (30 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É - –ª–∏–º–∏—Ç Telegram API)
  const batchSize = 30
  const delay = 1000 // 1 —Å–µ–∫—É–Ω–¥–∞ –º–µ–∂–¥—É –ø–∞–∫–µ—Ç–∞–º–∏

  for (let i = 0; i < telegramIds.length; i += batchSize) {
    const batch = telegramIds.slice(i, i + batchSize)
    
    // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∞–∫–µ—Ç–∞
    const promises = batch.map(async (telegramId) => {
      try {
        const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            chat_id: telegramId,
            text: messageText,
            parse_mode: options?.parseMode || 'Markdown',
            disable_web_page_preview: false,
            ...(options?.ctaText && options?.ctaLink ? {
              reply_markup: {
                inline_keyboard: [[
                  {
                    text: options.ctaText,
                    url: options.ctaLink
                  }
                ]]
              }
            } : {})
          }),
        })

        const result = await response.json()
        
        if (!response.ok || !result.ok) {
          failed++
          errors.push({
            telegramId,
            error: result.description || result.error_code || 'Unknown error'
          })
          return false
        }

        success++
        return true
      } catch (error: any) {
        failed++
        errors.push({
          telegramId,
          error: error.message || 'Network error'
        })
        return false
      }
    })

    await Promise.all(promises)

    // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–∞–∫–µ—Ç–∞–º–∏ (–∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ)
    if (i + batchSize < telegramIds.length) {
      await new Promise(resolve => setTimeout(resolve, delay))
    }
  }

  return { success, failed, errors }
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–∫–µ–Ω —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–æ–≥–æ –±–æ—Ç–∞ (`STUDENT_BOT_TOKEN`)
- –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∞–∫–µ—Ç–∞–º–∏ –ø–æ 30 —Å–æ–æ–±—â–µ–Ω–∏–π (–ª–∏–º–∏—Ç Telegram API)
- –ó–∞–¥–µ—Ä–∂–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞ –º–µ–∂–¥—É –ø–∞–∫–µ—Ç–∞–º–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–Ω–æ–ø–æ–∫ (inline keyboard)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É–¥–∞—á–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫

---

## 8. –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### 8.1 AuthContext

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/contexts/AuthContext.tsx`

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
```typescript
interface AuthContextType {
  user: User | null;
  loading: boolean;
  error: string | null;
  logout: () => Promise<void>;
  refreshUser: () => Promise<void>;
}
```

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- `user` - –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `loading` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
- `error` - —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

**–ú–µ—Ç–æ–¥—ã:**
- `logout()` - –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- `refreshUser()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 8.2 –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–§—É–Ω–∫—Ü–∏—è:** `loadUser(showLoading: boolean)`

**–ü—Ä–æ—Ü–µ—Å—Å:**
```typescript
const loadUser = useCallback(async (showLoading = true) => {
  setLoading(showLoading)
  setError(null)

  const token = getAuthToken()
  
  if (!token) {
    setUser(null)
    setLoading(false)
    return
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API
  const response = await apiRequest('/api/user/me')
  
  if (response.ok) {
    const currentUser = await response.json()
    setUser(currentUser)
    localStorage.setItem('user', JSON.stringify(currentUser))
    setError(null)
  } else if (response.status === 401) {
    // –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–µ–Ω
    removeAuthToken()
    setUser(null)
    setError('–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞')
  } else if (response.status === 403) {
    // –ù–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
    setError('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω')
  } else if (response.status === 503) {
    // –ü—Ä–æ–±–ª–µ–º—ã —Å –ë–î
    setError('–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')
  }
  
  setLoading(false)
}, [])
```

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:**
- –¢–æ–∫–µ–Ω –∏–∑ cookies (`getAuthToken()`)
- –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ API (`/api/user/me`)
- –ö—ç—à –≤ `localStorage` (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)

### 8.3 API Endpoint: `/api/user/me`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/app/api/user/me/route.ts`

**–ú–µ—Ç–æ–¥:** `GET`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
export async function GET(request: NextRequest) {
  return authenticatedHandler(request, async (user) => {
    return NextResponse.json(user)
  })
}
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `authenticatedHandler`
2. –í–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": "uuid",
  "name": "string",
  "login": "string",
  "profile_photo_url": "string|null",
  "role": "admin|teacher|student",
  "status": "registered|verified|banned|deleted",
  "telegram_id": "string|null"
}
```

### 8.4 –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

**API Endpoint:** `/api/auth/logout`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/app/api/auth/logout/route.ts`

**–ú–µ—Ç–æ–¥:** `POST`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
export async function POST(_request: NextRequest) {
  const response = NextResponse.json({
    success: true,
    message: '–í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ'
  })

  // –£–¥–∞–ª–µ–Ω–∏–µ cookie —Å —Ç–æ–∫–µ–Ω–æ–º
  response.cookies.delete('auth-token')
  
  return response
}
```

**–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å:**
```typescript
const logout = useCallback(async () => {
  try {
    await apiRequest('/api/auth/logout', { method: 'POST' })
  } catch (error) {
    console.error('Logout error:', error)
  } finally {
    // –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
    removeAuthToken()
    setUser(null)
    setError(null)
    window.location.href = '/login'
  }
}, [])
```

---

## 9. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 9.1 –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

**–ê–ª–≥–æ—Ä–∏—Ç–º:** bcrypt
**Salt rounds:** 12
**–í—Ä–µ–º—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:** ~300-500ms

**–ó–∞—â–∏—Ç–∞:**
- –ó–∞—â–∏—Ç–∞ –æ—Ç rainbow tables (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ salt)
- –ó–∞—â–∏—Ç–∞ –æ—Ç brute-force (–º–µ–¥–ª–µ–Ω–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –ö–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–µ –≤—Ä–µ–º—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–∑–∞—â–∏—Ç–∞ –æ—Ç timing attacks)

### 9.2 JWT —Ç–æ–∫–µ–Ω—ã

**–ê–ª–≥–æ—Ä–∏—Ç–º:** HS256
**–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á:** `JWT_SECRET` –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
**–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:** 7 –¥–Ω–µ–π

**–ó–∞—â–∏—Ç–∞:**
- –ü–æ–¥–ø–∏—Å—å —Ç–æ–∫–µ–Ω–∞ (–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ–ª–∫–∏)
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Ç–µ—á–µ–Ω–∏–µ)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–ª—å–Ω—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
- –•—Ä–∞–Ω–∏—Ç—å `JWT_SECRET` –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –≤ URL (—Ç–æ–ª—å–∫–æ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –∏–ª–∏ cookies)

### 9.3 Cookies

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
- `httpOnly: false` - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `secure: true` (–≤ production) - –ø–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–ª—å–∫–æ –ø–æ HTTPS
- `sameSite: 'lax'` - –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF
- `maxAge: 7 –¥–Ω–µ–π` - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è

**–ó–∞—â–∏—Ç–∞ –æ—Ç CSRF:**
- `sameSite: 'lax'` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É cookies —Å –≤–Ω–µ—à–Ω–∏—Ö —Å–∞–π—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

### 9.4 –ö–æ–¥—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –î–ª–∏–Ω–∞: 6 —Ü–∏—Ñ—Ä
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 5 –º–∏–Ω—É—Ç
- –û–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (—É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)

**–ó–∞—â–∏—Ç–∞:**
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
- –û–¥–Ω–æ—Ä–∞–∑–æ–≤–æ—Å—Ç—å
- –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ –∏ –ë–î (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥—ã –≤ production
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –≤–≤–æ–¥–∞ –∫–æ–¥–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å rate limiting –¥–ª—è API endpoints

### 9.5 –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- –ù–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
- –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è/–∫–æ–¥–∞

**–°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö:**
- –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç –¥–µ—Ç–∞–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å" –≤–º–µ—Å—Ç–æ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—à–∏–±–æ–∫

### 9.6 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–¢–∏–ø—ã –æ—à–∏–±–æ–∫:**
- `400` - –ù–µ–≤–µ—Ä–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `401` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `403` - –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω
- `404` - –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `500` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- `503` - –°–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–ø—Ä–æ–±–ª–µ–º—ã —Å –ë–î)

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ —Ç–æ–ª—å–∫–æ –≤ development —Ä–µ–∂–∏–º–µ

---

## 10. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 10.1 –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL="postgresql://user:password@localhost:5432/dbname"

# JWT
JWT_SECRET="your-super-secret-jwt-key-change-in-production"

# Node Environment
NODE_ENV="production" | "development"
```

### 10.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–±–ª–∏—Ü–∞ `settings`)

| –ö–ª—é—á | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------|----------|--------|
| `ADMIN_BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ | `123456789:ABCdef...` |
| `STUDENT_BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ | `987654321:XYZabc...` |

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞:**
1. –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ `settings` —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –∫–ª—é—á–æ–º

---

## 11. –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 11.1 –¢–∞–±–ª–∏—Ü–∞ `users`

**–ü–æ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `login` | String | –õ–æ–≥–∏–Ω (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π) |
| `hash_password` | String | –•–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å (bcrypt) |
| `name` | String | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `role` | Enum | `admin`, `teacher`, `student` |
| `status` | Enum | `registered`, `verified`, `banned`, `deleted` |
| `telegram_id` | String? | Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `profile_photo_url` | String? | URL —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è |

### 11.2 –¢–∞–±–ª–∏—Ü–∞ `settings`

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:**
- –•—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ Telegram –±–æ—Ç–æ–≤
- –•—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–¥–æ–≤ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `key` | String | –ö–ª—é—á –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| `value` | String | –ó–Ω–∞—á–µ–Ω–∏–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å JSON) |
| `created_at` | DateTime | –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è |

**–ü—Ä–∏–º–µ—Ä—ã –∫–ª—é—á–µ–π:**
- `ADMIN_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –±–æ—Ç–∞
- `STUDENT_BOT_TOKEN` - —Ç–æ–∫–µ–Ω —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–æ–≥–æ –±–æ—Ç–∞
- `verification_code_{userId}_{timestamp}` - –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

---

## 12. –ü–æ—Ç–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–¥–∏–∞–≥—Ä–∞–º–º–∞)

### 12.1 –ü–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫ –≤—Ö–æ–¥–∞ —Å Telegram 2FA

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ö–ª–∏–µ–Ω—Ç  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ 1. POST /api/auth/login {login, password}
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  API: /login    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Database      ‚îÇ
‚îÇ   (users)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  API: /login    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞
     ‚îÇ 5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
     ‚îÇ 6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ (–ø–∞–º—è—Ç—å + –ë–î)
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram Service‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ 7. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ –≤ Telegram
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram API    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ 8. –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ö–ª–∏–µ–Ω—Ç  ‚îÇ
‚îÇ (Telegram)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

     ‚îÇ 9. –í–≤–æ–¥ –∫–æ–¥–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  API: /verify   ‚îÇ
‚îÇ  -code          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ 10. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Verification    ‚îÇ
‚îÇ Service         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ 11. –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–¥–∞
     ‚îÇ 12. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ JWT
     ‚îÇ 13. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ cookie
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ö–ª–∏–µ–Ω—Ç  ‚îÇ
‚îÇ (Dashboard)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 12.2 –ü–æ—Ç–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ö–ª–∏–µ–Ω—Ç  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ 1. –ó–∞–ø—Ä–æ—Å —Å Authorization: Bearer <token>
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  auth()         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ 2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
     ‚îÇ 3. verifyToken()
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  JWT Verify     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∏ —Å—Ä–æ–∫–∞
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Database       ‚îÇ
‚îÇ  (users)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ 5. –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
     ‚îÇ 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Handler        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ 7. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ö–ª–∏–µ–Ω—Ç  ‚îÇ
‚îÇ (Response)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 13. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 13.1 Production

1. **JWT_SECRET:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫–∏–π –∫–ª—é—á (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
   - –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º
   - –•—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

2. **HTTPS:**
   - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS –≤ production
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `secure: true` –¥–ª—è cookies

3. **Rate Limiting:**
   - –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
   - –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–¥–∞
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å middleware –¥–ª—è rate limiting

4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª–∏ –∏ —Ç–æ–∫–µ–Ω—ã
   - –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏ –∏ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

5. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å connection pooling
   - –†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø—ã
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### 13.2 Development

1. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.env.local` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
   - –ù–µ –∫–æ–º–º–∏—Ç–∏—Ç—å `.env` —Ñ–∞–π–ª—ã –≤ git

2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤—Ö–æ–¥–∞
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

---

## 14. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Bilimpoz Admin –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (bcrypt)
- JWT —Ç–æ–∫–µ–Ω—ã —Å –ø–æ–¥–ø–∏—Å—å—é
- –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
- –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF (sameSite cookies)

‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–¥–æ–≤ (–ø–∞–º—è—Ç—å + –ë–î)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –∫–æ–¥–æ–≤

‚úÖ **–£–¥–æ–±—Å—Ç–≤–æ:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ localStorage

‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:**
- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0  
**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2024  
**–ê–≤—Ç–æ—Ä:** Bilimpoz Admin Development Team

